<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Study Adventure</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div id="app">
    <!-- 認証画面 -->
    <section id="authSection" class="authSection">
      <div class="authCard">
        <h1>Study Adventure</h1>
        <div id="authError" class="authError"></div>
        
        <!-- ログインフォーム -->
        <form id="loginForm" class="authForm">
          <h2>ログイン</h2>
          <div class="field">
            <label>メールアドレス</label>
            <input id="loginEmail" type="email" required placeholder="email@example.com" />
          </div>
          <div class="field">
            <label>パスワード</label>
            <input id="loginPassword" type="password" required placeholder="6文字以上" />
          </div>
          <button id="loginBtn" class="primary full">ログイン</button>
          <div class="authSwitch">
            アカウントをお持ちでない方は<br>
            <a href="#" id="showSignupBtn">新規登録</a>
          </div>
        </form>
        
        <!-- 新規登録フォーム -->
        <form id="signupForm" class="authForm" style="display:none;">
          <h2>新規登録</h2>
          <div class="field">
            <label>メールアドレス</label>
            <input id="signupEmail" type="email" required placeholder="email@example.com" />
          </div>
          <div class="field">
            <label>パスワード</label>
            <input id="signupPassword" type="password" required placeholder="6文字以上" />
          </div>
          <button id="signupBtn" class="primary full">登録</button>
          <div class="authSwitch">
            すでにアカウントをお持ちの方は<br>
            <a href="#" id="showLoginBtn">ログイン</a>
          </div>
        </form>
      </div>
    </section>

    <!-- アプリ画面 -->
    <section id="appSection" style="display:none;">
      <header class="top">
        <div class="topRow">
          <h1>Study Adventure</h1>

          <nav class="tabs" aria-label="tabs">
            <button class="tab active" data-tab="home">Home</button>
            <button class="tab" data-tab="story">Story</button>
          </nav>
        </div>

        <div class="hud" aria-label="hud">
          <div class="hudItem">TODAY <b id="todayMin">0分</b></div>
          <div class="hudItem">TOTAL <b id="totalMin">0分</b></div>
          <div class="hudItem">STREAK <b id="streak">0</b></div>
          <div class="hudItem user">
            <span id="userEmail"></span>
            <button id="logoutBtn" class="logoutBtn">ログアウト</button>
          </div>
        </div>
      </header>

      <main>
        <!-- ===== Home ===== -->
        <section id="tab-home" class="tabPanel">
          <section class="card">
            <div class="row">
              <div>
                <div class="label">冒険の進捗</div>
                <div class="big"><b id="km">0.0</b> km</div>
                <div class="sub">次のエリアまで <b id="toNext">0</b> </div>
                <div class="sub">次のストーリーまで <b id="toNextStory">0</b> </div>
              </div>
              <div class="badge" id="areaBadge">Area 1</div>
            </div>

            <div class="barWrap" aria-label="progress">
              <div class="bar" id="bar"></div>
            </div>

            <div class="btnRow">
              <button id="startBtn" class="primary">Start</button>
              <button id="stopBtn" class="ghost" disabled>Stop</button>
              <button id="addBtn" class="ghost">+ 手入力</button>
            </div>

            <div class="hint" id="timerHint">未計測</div>
          </section>

          <section class="card">
            <div class="label">今日のログ</div>
            <div id="logList" class="logList"></div>
            <div class="logActions">
              <button id="resetTodayBtn" class="danger">今日をリセット</button>
              <button id="resetAllBtn" class="danger">全部リセット</button>
            </div>
          </section>
        </section>

        <!-- ===== Story ===== -->
        <section id="tab-story" class="tabPanel hidden">
          <section class="card">
            <div class="row">
              <div>
                <div class="label">ストーリー</div>
                <div class="sub">勉強時間で解放。読んだらチェックがつく。</div>
              </div>
              <div class="badge" id="storyBadge">Unlocked 0</div>
            </div>

            <div id="storyList" class="storyList"></div>
          </section>
        </section>
      </main>

      <!-- 手入力 -->
      <dialog id="addDialog">
        <form method="dialog" class="dialog">
          <h2>手入力で追加</h2>

          <div class="field">
            時間と分
            <div class="hmRow">
              <input id="addHours" type="number" min="0" max="24" placeholder="時間" />
              <span>時間</span>
              <input id="addMins" type="number" min="0" max="59" placeholder="分" />
              <span>分</span>
            </div>
          </div>

          <label class="field">
            メモ(任意)
            <input id="addMemo" type="text" maxlength="60" placeholder="例:管理会計 章3" />
          </label>

          <menu class="menu">
            <button value="cancel" class="ghost">キャンセル</button>
            <button id="saveAddBtn" value="ok" class="primary">追加</button>
          </menu>
        </form>
      </dialog>

      <!-- エリア解放 -->
      <dialog id="unlockDialog">
        <div class="dialog">
          <h2>エリア解放!</h2>
          <p id="unlockText"></p>
          <menu class="menu">
            <button id="closeUnlockBtn" class="primary">OK</button>
          </menu>
        </div>
      </dialog>

      <!-- ストーリー本文 -->
      <dialog id="storyDialog">
        <div class="dialog storyDialog">
          <div class="row">
            <h2 id="storyTitle" class="storyTitle">Episode</h2>
            <button id="closeStoryBtn" class="ghost">閉じる</button>
          </div>
          <div id="storyMeta" class="sub"></div>
          <div id="storyBody" class="storyBody"></div>
          <div id="choiceBox" class="choiceBox"></div>

          <menu class="menu">
            <button id="markReadBtn" class="primary">読了にする</button>
          </menu>
        </div>
      </dialog>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
